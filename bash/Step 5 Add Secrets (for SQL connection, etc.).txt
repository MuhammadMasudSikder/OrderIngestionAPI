kubectl create secret generic db-connection  --from-literal=connectionstring=Server=tcp:orderingestion-sql.database.windows.net,1433;Initial Catalog=orderingestiondb;Persist Security Info=False;User ID=sqladminuser;Password={your_password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;  -n orderingestion-api-prod


kubectl create secret generic db-connection --from-literal=connectionstring="Server=tcp:orderingestion-sql.database.windows.net,1433;Initial Catalog=orderingestiondb;Persist Security Info=False;User ID=sqladminuser;Password={your_password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -n orderingestion-api-prod



kubectl rollout restart deployment orderingestion-api -n orderingestion-prod

kubectl get pods -n orderingestion-prod
kubectl logs -n orderingestion-prod orderingestion-api-646d998b5f-56xsl --previous

Verify AKS can connect to SQL Server

Test connectivity from inside the cluster:

kubectl run sqltest --rm -it --image=mcr.microsoft.com/mssql-tools -- bash


Then inside the pod:

sqlcmd -S tcp:orderingestion-sql.database.windows.net,1433 -U sqladminuser -P 'P@ssw0rd1234!' -d orderingestiondb


If login fails, you have a network/firewall or credential issue.




Option 2: Delete and recreate the secret
kubectl delete secret db-connection -n orderingestion-prod

kubectl create secret generic db-connection --from-literal=connectionstring="Server=tcp:orderingestion-sql.database.windows.net,1433;Initial Catalog=orderingestiondb;Persist Security Info=False;User ID=sqladminuser;Password=P@ssw0rd1234!;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;" -n orderingestion-prod --dry-run=client -o yaml | kubectl apply -f -

  
  Step 3: Restart the API deployment

After updating the secret, restart the deployment to pick up the new connection string:

kubectl rollout restart deployment orderingestion-api -n orderingestion-prod

Verify

Use your curltest pod again:
kubectl delete pod curltest -n orderingestion-prod --force --grace-period=0

kubectl run curltest --image=curlimages/curl -it --rm --restart=Never --namespace orderingestion-prod -- curl -v http://orderingestion-api:8080/api/product



admin@orderingestion.com
Admin@123#


Server=tcp:orderingestion-sql.database.windows.net,1433;Initial Catalog=orderingestiondb;Persist Security Info=False;User ID=sqladminuser;Password={your_password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;

kubectl apply -f orderingestion-api-deployment.yaml